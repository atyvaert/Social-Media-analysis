---
title: "Basetablecreation"
output: html_notebook
---


```{r}
### Basetable creation and splitting ###

set.seed(123)
rm(list = ls())

###### Read Data ######
load("/Users/wouterdewitte/Documents/GitHub/SMWA_Performance/data/All_tweets_with_sentiment.RData")

load("/Users/wouterdewitte/Documents/GitHub/SMWA_Performance/data/Financial_Data.RData")
```

```{r}
# Clean financial data
financial_data <- data
names(financial_data)[names(financial_data) == "Date"] <- "date"

financial_data$Target <- sign(financial_data$Target)

```

```{r}
# Clean tweet data
all_tweets <- subset(all_tweets, select = -c(text, user_id))

# Splitting in train and test set
dt = sample(nrow(all_tweets), nrow(all_tweets)*.8)
tweets_train <- all_tweets[dt,]
tweets_test <- all_tweets[-dt,]

# MinMaxScale sentiments
num.cols <- sapply(all_tweets, is.numeric)

# apply on training set
mean_train <- colMeans(tweets_train[, num.cols])
sd_train <- sapply(tweets_train[, num.cols], sd)
tweets_train[, num.cols] <- scale(tweets_train[, num.cols], center = TRUE, scale = TRUE)

# apply on test set
tweets_test[, num.cols] <- scale(tweets_test[, num.cols], center = mean_train, scale = sd_train)

# Aggregate
tweets_train_agg <- aggregate(cbind(tweets_train$sentiment_by_basic, tweets_train$sentiment_weighted_mixed, tweets_train$sentiment_average_mean, tweets_train$sentiment_by_dicitonary) ~ tweets_train$date, tweets_train, mean)

tweets_test_agg <- aggregate(cbind(tweets_test$sentiment_by_basic, tweets_test$sentiment_weighted_mixed, tweets_test$sentiment_average_mean, tweets_test$sentiment_by_dicitonary) ~ tweets_test$date, tweets_test, mean)

# Change colnames
colnames(tweets_train_agg) <- colnames(all_tweets)
colnames(tweets_test_agg) <- colnames(all_tweets)
names(tweets_train_agg)[5] <- "sentiment_by_dictionary"
names(tweets_test_agg)[5] <- "sentiment_by_dictionary"

# Clean date
tweets_train_agg$date <- strptime(as.character(tweets_train_agg$date), "%m/%d/%Y")
tweets_train_agg$date <- format(tweets_train_agg$date, "%Y-%m-%d")

tweets_test_agg$date <- strptime(as.character(tweets_test_agg$date), "%m/%d/%Y")
tweets_test_agg$date <- format(tweets_test_agg$date, "%Y-%m-%d")
```

```{r}
# Making basetable
basetable_train <- merge(tweets_train_agg,financial_data,by="date")
basetable_test <- merge(tweets_test_agg,financial_data,by="date")
```

```{r}
# Splitting in train and test set

dt = sample(nrow(data), nrow(data)*.8)
train <- data[dt,]
test <- data[-dt,]

train_x <- subset(train, select = -c(Target))
train_y <- train$Target

test_x <- subset(test, select = -c(Target))
test_y <- test$Target

```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

